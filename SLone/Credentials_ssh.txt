*** Settings ***
Suite Setup
Suite Teardown
Resource          mt_common.txt

*** Test Cases ***
Verify simple multitenantcy
    [Documentation]    TID17691
    ...
    ...    Create a Credential ssh \ in ORG1 as the MT_USER1 account.
    ...
    ...    Verify MT_USER1 can access.
    ...
    ...    Verify MT_USER2 cannot access (no org membership)
    ...
    ...    Verify MT_USER3 can access (member of both ORG1 & 2)
    [Tags]    defect    noncritical
    ${credType}    Set Variable    ssh
    ${orgList}    Create List    ${ORG1}
    Add to payload    cred_name    testCred
    Add to payload    all_orgs    0
    Add to payload    aligned_organizations    ${orgList}
    request    post    /credential/${credType}    ${MT_USER1}    ${MT_PASS1}
    HTTP response code should be    201
    ${uri}    get uri
    request    get    ${uri}    ${MT_USER1}    ${MT_PASS1}
    HTTP response code should be    200
    Check response payload    aligned_organizations    ${orgList}
    request    get    ${uri}    ${MT_USER2}    ${MT_PASS2}
    HTTP response code should be    403
    request    get    ${uri}    ${MT_USER3}    ${MT_PASS3}
    HTTP response code should be    200
    [Teardown]    Cleanup API Object    ${uri}
